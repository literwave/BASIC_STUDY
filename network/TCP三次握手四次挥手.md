### TCP三次握手四次挥手

* 三次握手
  * 客户端发给服务端`SYN`报文，并指明客户端的初始序列号`ISN`，客户端处于`SYN_SENT`状态，客户端：客户端发送能力正常。
  * 服务端收到客户端的`SYN`报文之后，会以自己的`SYN`报文作为应答，并且也是指明了自己的`ISN`，同时会把客户端的`ISN+1`作为`ack`的值，此时服务端处于`SYN_RECEIVED`状态，服务端发送给客户端`SYN+ACK`报文(两个包)，服务端：服务端接收能力正常，客户端发送能力正常。
  * 客户端收到了`SYN+ACK`报文后，会发送一个`ACK`报文，同时会把服务端的`ISN+1`作为`ack`的值，客户端：服务端接收能力和发送能力正常，客户端发送能力和接收能力正常；服务端：客户端发送能力和接收能力正常，服务端发送能力和接收能力正常。
    - `SYN`全称`Synchronize Sequence Numbers`,中文译名：同步序列编号。
    - `ISN`全称`Initial Sequence Number`，中文译名：初始序列号。
    - `ACK`全称`ACKnowledge Character`，中文译名：应答字符。
  * 注意`ACK`和`ack`的区别
    * `ACK`即为`TCP报文段首部`中的`ACK`字段，置`1`时该报文段为确认报文段。
    * `ack`则为`TCP报文段首部`中`确认号字段`的具体数值。
  * 总结
    * 三次握手是指双方确认对方和自己的发送能力和接收能力正常。
  * 半链接队列
    * 半连接队列是用于存储等待客户端`ACK`的连接队列
  * `SYN`泛洪攻击
    * 攻击者向服务器发送大量的`SYN`包，但并不发送`ACK`包来完成连接建立，从而导致服务器的半连接队列满，无法接受新的连接请求
* 四次挥手
  * 可以客户端主动断开连接或服务端主动断开连接，这里举例客户端->服务端，客户端发送给服务端`FIN`报文，报文中带有序列号，客户端处于`FIN_WAIT1`状态
  * 服务端收到客户端的`FIN`报文，发送一个`ACK`报文，`ack`的值为`ISN + 1`，此时服务端处于`CLOSE_WAIT`状态。
  * 服务端处理完当前需要发送的数据，服务端主动发送一个`FIN`报文，且指定一个序列号，此时服务端处于`LAST_ACK`的状态。
  * 客户端收到了`FIN`报文，发送一个`ACK`报文作为应答，`ack = ack + 1`，此时客户端处于`TIME_WAIT`状态，需要过一段时间确保服务端收到自己的`ACK`报文之后才会进入`CLOSED`状态。服务端收到`ACK`报文之后，就处于`CLOSED`状态。如果没收到就定时发`FIN`报文给客户端
    * `FIN`全称`FINISH`，中文译名：结束报文。